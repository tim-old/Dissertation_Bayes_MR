---
title: "4. Results"
output:
  pdf_document:
    latex_engine: xelatex
    dev: cairo_pdf
knit: (function(inputFile, encoding) {
      rmarkdown::render(inputFile,
                        encoding = encoding,
                        knit_root_dir = rprojroot::find_rstudio_root_file(),
                        output_dir = file.path("../Output")
                        )})
---

```{r setup, echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE}

knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE, 
                      message = FALSE, 
                      error = FALSE,
                      cache = TRUE, 
                      include = FALSE 
                      #dev = "png", 
                      #dpi = 500
)

# Load packages
library(tidyverse)
library(TwoSampleMR)
library(rstan)
library(here)
library(cowplot)
library(kableExtra)

# Load University of Edinburgh colour palette
source(here("MSc_Thesis_Split", "Script", "edin_uni_colours.R"))

# Load pre-formatted plot template - call to ggplot with UoE colours
source(here("MSc_Thesis_Split", "Script", "edin_fig_style.R"))

# Load function scripts
source(here("MSc_Thesis_Split", "Script", "simulation_functions.R"))
source(here("MSc_Thesis_Split", "Script", "Hevo", "functions.mrhevo.R"))


# Compile model for MR-Hevo
mr.stanmodel <- stan_model(file = here("MSc_Thesis_Split", 
                                       "Script", 
                                       "Hevo", 
                                       "MRHevo_summarystats.stan"),
                           model_name="MRHevo.summarystats", verbose=FALSE)


```



```{r no-causal-tenk-point1-scen1}

# Load datasets
no_causal_10k_point1_scen1_models <- readRDS(file = here("MSc_Thesis_Split", "Data", "Simulated_Datasets", "no_causal_10k_point1_scen1_models.rds"))

no_causal_10k_point1_scen1_subset <- no_causal_10k_point1_scen1_models[1:20]

#no_causal_tenk_point1_scen1 <- get_summary_MR_tib_row(no_causal_tenk_point1_scen1_models)
no_causal_10k_point1_scen1 <- get_summary_MR_tib_row(no_causal_10k_point1_scen1_subset)

no_causal_10k_point1_scen1

```

```{r no-causal-tenk-point2-scen1}

# Load datasets
no_causal_10k_point2_scen1_models <- readRDS(file = here("MSc_Thesis_Split", "Data", "Simulated_Datasets", "no_causal_10k_point2_scen1_models.rds"))

no_causal_10k_point2_scen1_subset <- no_causal_10k_point2_scen1_models[1:20]

no_causal_10k_point2_scen1 <- get_summary_MR_tib_row(no_causal_10k_point2_scen1_subset)

no_causal_10k_point2_scen1

```


```{r causal-tenk-point2-scen1}

# Load datasets

causal_10k_point2_scen1_models <- readRDS(file = here("MSc_Thesis_Split", "Data", "Simulated_Datasets", "causal_10k_point2_scen1_models.rds"))

causal_10k_point2_scen1_subset <- causal_10k_point2_scen1_models[1:20]

causal_10k_point2_scen1 <- get_summary_MR_tib_row(causal_10k_point2_scen1_subset)

causal_10k_point2_scen1

```





```{r scen1-sim-summ-tib, echo=FALSE, warning=FALSE, cache=TRUE, include=TRUE, fig.width=10}

scen1_sim_summ_tib <- bind_rows(no_causal_10k_point1_scen1,
                                no_causal_10k_point2_scen1,
                                causal_10k_point2_scen1
                                )

scen1_sim_summ_tib %>%
  mutate(WME = paste0(WME_Av, " (", WME_SE, ")"),
         Hevo = paste0(Hevo_Av, " (", Hevo_SE, ")")) %>%
  select(N, Prop_Invalid, F_stat, R2_stat, WME, WME_Pos_Rate, Hevo, Hevo_Pos_Rate) %>%
  kable(col.names = c("N",
                      "Proportion of Invalid IVs",
                      "$F$",
                      "$R^2$", #"\U00B2$",
                      "WME Mean Estimate (Mean SE)",
                      "WME Causal Report Rate",
                      "MR-Hevo Mean Estimate (Mean SE)",
                      "MR-Hevo Causal Report Rate"
                      ),
        escape = TRUE) %>%
  kable_styling() %>%
  column_spec(column = c(1:8),
              width = c("0.5cm", "2cm", "0.75cm", "0.75cm", "3cm", "3cm", "3.5cm", "3cm")) #%>% 
  #row_spec(row = 0, italic = c(FALSE, FALSE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE))

```


Word count: `r wordcountaddin::word_count(here::here("MSc_Thesis_Split", "Script", "_4_Results.Rmd"))`